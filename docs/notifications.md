# Governance Notifications

Proactive alerts delivered as GitHub issues in the governed repository.

## How It Works

The `NotificationService` monitors governance activity and creates GitHub issues when attention is needed. Issues are labeled `governance-alert` for easy filtering.

### Alert Types

| Type | Trigger | Labels |
|------|---------|--------|
| **Pending challenge** | Challenge unanswered for >1 hour | `challenge`, `needs-attention` |
| **Overturned challenge** | Challenge accepted, reversing a decision | `challenge-accepted`, `escalation` |
| **Session failures** | 3+ agent sessions failed in 6 hours | `session-failure`, `needs-attention` |
| **Weekly summary** | Scheduled weekly digest of governance activity | `summary` |

### Deduplication

Each notification has a dedupe key checked against the audit log. If the same key was used in the last 7 days, the notification is skipped.

### Audit Trail

Every notification is logged to `audit_log` with `event_type = 'notification'`, including the GitHub issue number.

## Production Scheduling

Notifications are triggered by two GitHub Actions workflows:

**Daily checks** (`.github/workflows/daily-maintenance.yml`):
- Runs at 08:00 UTC daily
- Calls `POST /admin/notifications/check` before daily maintenance
- Checks for: pending challenges, overturned challenges, session failures

**Weekly summaries** (`.github/workflows/weekly-summary.yml`):
- Runs every Monday at 09:00 UTC
- Fetches all registered projects and generates a summary for each
- Calls `POST /admin/projects/:id/summary`

Both can be triggered manually via GitHub Actions `workflow_dispatch`.

### Required Setup

1. Set `SERVICE_URL` as a GitHub repository variable (Settings -> Variables -> Actions) pointing to your App Runner URL
2. `ADMIN_API_KEY` must be in GitHub Secrets (for workflow authentication)
3. GitHub App must have issue write permissions on governed repositories

## API Endpoints

| Endpoint | Description |
|----------|-------------|
| `POST /admin/notifications/check` | Run all notification checks |
| `POST /admin/projects/:id/summary` | Generate weekly summary for a project |

Both require `x-admin-key` header.

## What Project Owners See

Example issue created in their repository:

```
Title: Pending Challenge: Adopt semantic versioning for API
Labels: governance-alert, challenge, needs-attention

A challenge has been pending for over an hour and needs attention.

**Decision:** Adopt semantic versioning for API (`my-project-0012`)
**Challenged by:** contributor-name
**Submitted:** 2025-01-15T14:30:00Z

**Argument:**
> The decision doesn't account for pre-1.0 projects where breaking
> changes are expected...

---
*Generated by AI Governance notification service for project `my-project`*
```
